# tinyCoroLab å­¦ä¹ ç¬”è®°

> C++20 åç¨‹ + Linux io_uring å¼‚æ­¥åç¨‹åº“å®éªŒè¯¾ç¨‹

---

## ç›®å½•

- [ğŸ“š è¯¾ç¨‹èµ„æº](#-è¯¾ç¨‹èµ„æº)
- [ğŸ› ï¸ ç¯å¢ƒé…ç½®](#ï¸-ç¯å¢ƒé…ç½®)
- [âš ï¸ å¸¸è§é—®é¢˜è§£å†³](#ï¸-å¸¸è§é—®é¢˜è§£å†³)
- [ğŸ“– åç¨‹åŸºç¡€æ¦‚å¿µ](#-åç¨‹åŸºç¡€æ¦‚å¿µ)
- [ğŸ”„ C++20 åç¨‹æœºåˆ¶](#-c20-åç¨‹æœºåˆ¶)
- [ğŸ§© åç¨‹æ ¸å¿ƒç»„ä»¶](#-åç¨‹æ ¸å¿ƒç»„ä»¶)
- [âš¡ await_suspend è¿”å›ç±»å‹å¯¹æ¯”](#-await_suspend-è¿”å›ç±»å‹å¯¹æ¯”)
- [ğŸ”§ Linux I/O æ¨¡å‹å¯¹æ¯”](#-linux-io-æ¨¡å‹å¯¹æ¯”)
- [ğŸŒ TCP Awaiter é€šä¿¡æµç¨‹](#-tcp-awaiter-é€šä¿¡æµç¨‹)
- [ğŸ—ï¸ tinyCoroLab æ¶æ„](#ï¸-tinycorolab-æ¶æ„)
- [ğŸ“Š æ€§èƒ½æµ‹è¯•åˆ†æ](#-æ€§èƒ½æµ‹è¯•åˆ†æ)

---

## ğŸ“š è¯¾ç¨‹èµ„æº

| èµ„æº | é“¾æ¥ |
|------|------|
| è“æ¡¥äº‘è¯¾ | https://www.lanqiao.cn/courses/46713/learning/?id=4073445&compatibility=false |
| GitHub ä»“åº“ | https://github.com/sakurs2/tinyCoroLab |
| WSL å®‰è£…æŒ‡å— | https://cloud.tencent.com/developer/article/1771472 |

---

## ğŸ› ï¸ ç¯å¢ƒé…ç½®

### WSL å®‰è£…

```bash
# PowerShell ç®¡ç†å‘˜èº«ä»½è¿è¡Œ - å¯ç”¨ WSL åŠŸèƒ½
dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart

# å®‰è£… WSLï¼ˆè‹¥å¡ä½åˆ™ä½¿ç”¨ --web-downloadï¼‰
wsl --install
wsl --install --web-download                    # å®‰è£… WSL å¡ä½æ—¶
wsl --install -d Ubuntu --web-download          # å®‰è£… Ubuntu å¡ä½æ—¶

# å…³é—­ WSL
wsl --shutdown
```

### å¼€å‘å·¥å…·å®‰è£…

```bash
# GCC ç¼–è¯‘å™¨
sudo apt update && sudo apt install build-essential

# CMake
sudo apt update && sudo apt install cmake

# Rust/Cargoï¼ˆæµ‹è¯•å·¥å…·éœ€è¦ï¼‰
# å®‰è£…åæ–°ç»ˆç«¯è‡ªåŠ¨åŠ è½½ï¼Œå½“å‰ç»ˆç«¯éœ€æ‰§è¡Œï¼š
source "$HOME/.cargo/env"
cargo --version
```

### ç¼–è¯‘å‘½ä»¤

```bash
# C æ–‡ä»¶ç¼–è¯‘
gcc sys_call.c -o sys_call

# C++20 åç¨‹ç¼–è¯‘ï¼ˆéœ€è¦ -std=c++20 å’Œ -fcoroutinesï¼‰
g++ -std=c++20 -O2 coroutine_test.cpp -o coroutine_test
g++ -std=c++20 -O2 -Wall ucontext_exp.cpp -o ucontext_exp && ./ucontext_exp
```

---

## âš ï¸ å¸¸è§é—®é¢˜è§£å†³

### VS Code #include é”™è¯¯

`Ctrl+Shift+P` â†’ æœç´¢ `C/C++: Edit configurations (UI)` â†’ ç¼–è¾‘ Include pathï¼š

```
${workspaceFolder}/**
/usr/include
/usr/local/include
/usr/include/c++/13
/usr/include/x86_64-linux-gnu/c++/13
```

### CLOCK_MONOTONIC undefined é”™è¯¯

åœ¨ä»£ç æœ€å‰é¢æ·»åŠ  POSIX å®å®šä¹‰ï¼š

```cpp
#define _POSIX_C_SOURCE 199309L
```

### WSL ä¸­æ— æ³•ä½¿ç”¨ Copilot

1. æ‰“å¼€è®¾ç½® â†’ Remote [WSL: Ubuntu] â†’ æœç´¢ `proxy`
2. å–æ¶ˆå‹¾é€‰ `Http: Use Local Proxy Configuration`
3. è‹¥ä»ä¸è¡Œï¼Œå°† `Http: Proxy Support` ä» `override` æ”¹ä¸º `on`

---

## ğŸ“– åç¨‹åŸºç¡€æ¦‚å¿µ

### åç¨‹ vs çº¿ç¨‹

| ç‰¹æ€§ | çº¿ç¨‹ | åç¨‹ |
|------|------|------|
| è°ƒåº¦ | æ“ä½œç³»ç»Ÿå†…æ ¸æ€ | ç”¨æˆ·æ€ |
| åˆ‡æ¢å¼€é”€ | é«˜ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢ï¼‰ | ä½ï¼ˆæ— ç³»ç»Ÿè°ƒç”¨ï¼‰ |
| å†…å­˜å ç”¨ | MB çº§åˆ« | KB çº§åˆ« |
| æ•°é‡é™åˆ¶ | æ•°åƒä¸ª | æ•°åä¸‡ä¸ª |
| ä»£ç é£æ ¼ | å›è°ƒ/å¼‚æ­¥ | åŒæ­¥é£æ ¼ |

**ä¼ ç»Ÿæ¨¡å‹**ï¼šä¸€ä¸ªçº¿ç¨‹ â†’ ä¸€ä¸ªä»»åŠ¡ï¼ŒIO é˜»å¡å¯¼è‡´èµ„æºæµªè´¹

**åç¨‹æ¨¡å‹**ï¼šä¸€ä¸ªçº¿ç¨‹ â†’ å¤šä¸ªåç¨‹ï¼Œåç¨‹ä¸»åŠ¨è®©å‡ºæ‰§è¡Œæƒï¼Œé«˜æ•ˆå¹¶å‘

### ç›¸å…³å¤´æ–‡ä»¶

```cpp
#include <ucontext.h>  // ç”¨æˆ·ä¸Šä¸‹æ–‡ï¼Œåç¨‹/ä¿¡å·å¤„ç†/ä¸Šä¸‹æ–‡åˆ‡æ¢
#include <unistd.h>    // POSIX ç³»ç»Ÿè°ƒç”¨ï¼ˆæ–‡ä»¶æ“ä½œã€è¿›ç¨‹æ§åˆ¶ç­‰ï¼‰
```

---

## ğŸ”„ C++20 åç¨‹æœºåˆ¶

### è°ƒåº¦ç‚¹ï¼ˆScheduling Pointsï¼‰

| è°ƒåº¦ç‚¹ | æ—¶æœº | ç”¨é€” |
|--------|------|------|
| åç¨‹åˆ›å»ºæ—¶ | `initial_suspend()` | å»¶è¿Ÿå¯åŠ¨ï¼Œç­‰å¾…å‡†å¤‡å·¥ä½œå®Œæˆ |
| `co_await` å¤„ | è¿è¡Œä¸­ | å†³å®šæ˜¯å¦æŒ‚èµ·ï¼Œæ‰§è¡Œè°ƒåº¦é€»è¾‘ |
| åç¨‹é”€æ¯æ—¶ | `final_suspend()` | å†³å®šä¸‹ä¸€ä¸ªæ‰§è¡Œçš„åç¨‹ |

> âš ï¸ **æ³¨æ„**ï¼š`final_suspend` åä¼šé”€æ¯åç¨‹ï¼Œä¸è¦åœ¨æ­¤è®©å½“å‰åç¨‹ç»§ç»­è¿è¡Œï¼Œå¦åˆ™ core dump

### å¯¹ç§° vs éå¯¹ç§°åç¨‹

- **éå¯¹ç§°åç¨‹**ï¼ˆC++20ï¼‰ï¼šæŒ‚èµ·æ—¶åªèƒ½è¿”å›ç»™è°ƒç”¨è€…/æ¢å¤è€…
- **å¯¹ç§°åç¨‹**ï¼šå¯ä»¥éšæ„æŒ‡å®šè·³è½¬åˆ°å“ªä¸ªåç¨‹
- C++20 å¯é€šè¿‡ **å¯¹ç§°è½¬æ¢ä¼˜åŒ–** å®ç°å¯¹ç§°åç¨‹è¡Œä¸º

---

## ğŸ§© åç¨‹æ ¸å¿ƒç»„ä»¶

### Promiseï¼ˆæ‰¿è¯ºå¯¹è±¡ï¼‰

åç¨‹çŠ¶æ€å’Œç»“æœçš„ç®¡ç†è€…ï¼Œè´Ÿè´£ï¼š
- æŒ‚èµ·/æ¢å¤æ§åˆ¶
- ç»“æœä¼ é€’
- å¼‚å¸¸å¤„ç†

**å·¥ä½œæµç¨‹**ï¼š
1. åç¨‹è°ƒç”¨æ—¶ â†’ ç¼–è¯‘å™¨åˆ›å»º promise å¯¹è±¡
2. åç¨‹æ‰§è¡Œä¸­ â†’ promise ç®¡ç†æŒ‚èµ·ç‚¹å’Œæ¢å¤ç‚¹
3. åç¨‹å®Œæˆæ—¶ â†’ promise å­˜å‚¨ç»“æœæˆ–æŠ›å‡ºå¼‚å¸¸
4. è°ƒç”¨è€… â†’ é€šè¿‡ future ç­‰æœºåˆ¶è·å–ç»“æœ

### Awaiterï¼ˆç­‰å¾…å™¨ï¼‰

å®ç°ä¸‰ä¸ªæ–¹æ³•çš„å¯¹è±¡ï¼Œå¯æ”¾åœ¨ `co_await` åé¢ï¼š

```cpp
struct MyAwaiter {
    bool await_ready();                          // æ˜¯å¦éœ€è¦æŒ‚èµ·
    void/bool/handle await_suspend(handle h);    // æŒ‚èµ·æ—¶çš„æ“ä½œ
    T await_resume();                            // æ¢å¤æ—¶è¿”å›å€¼
};
```

**æ ‡å‡†åº“ Awaiter**ï¼š
- `std::suspend_never` - æ°¸ä¸æŒ‚èµ·
- `std::suspend_always` - æ€»æ˜¯æŒ‚èµ·

### ç¼–è¯‘å™¨éšå¼è½¬æ¢

```cpp
// ç”¨æˆ·ä»£ç                     ç¼–è¯‘å™¨ç”Ÿæˆ
co_return value;        â†’    promise.return_value(value);
co_return;              â†’    promise.return_void();
co_yield value;         â†’    co_await promise.yield_value(value);  // äº§ç”Ÿè°ƒåº¦ç‚¹
```

---

## âš¡ await_suspend è¿”å›ç±»å‹å¯¹æ¯”

| è¿”å›ç±»å‹ | æ§åˆ¶æ–¹å¼ | æ ˆæº¢å‡ºé£é™© | æ€§èƒ½ | ä½¿ç”¨åœºæ™¯ |
|----------|----------|------------|------|----------|
| `void` | è¢«åŠ¨è½¬ç§»ï¼ˆè¿”å›è°ƒç”¨è€…ï¼‰ | âŒ å¯èƒ½ | â­â­â­ æœ€ä¼˜ | ç®€å•æŒ‚èµ· |
| `bool` | è¢«åŠ¨è½¬ç§»ï¼ˆtrue=æŒ‚èµ·ï¼‰ | âŒ å¯èƒ½ | â­â­â­ æœ€ä¼˜ | æ¡ä»¶æŒ‚èµ· |
| `coroutine_handle<>` | ä¸»åŠ¨è½¬ç§»ï¼ˆæŒ‡å®šåç¨‹ï¼‰ | âœ… å®‰å…¨ | â­â­ è¾ƒä¼˜ | å¯¹ç§°è½¬æ¢ |

> ğŸ’¡ **å»ºè®®**ï¼šä¸éœ€è¦ä¸»åŠ¨è½¬ç§»æ‰§è¡Œæƒæ—¶ï¼Œä¼˜å…ˆä½¿ç”¨ `void` æˆ– `bool` è¿”å›ç±»å‹

---

## ğŸ”§ Linux I/O æ¨¡å‹å¯¹æ¯”

### epoll vs aio vs io_uring

| ç‰¹æ€§ | epoll | aio | io_uring |
|------|-------|-----|----------|
| ç±»å‹ | å¤šè·¯å¤ç”¨ | å¼‚æ­¥ I/O | å¼‚æ­¥ I/O |
| ç½‘ç»œ I/O | âœ… | âœ… | âœ… |
| æ–‡ä»¶ I/O | âŒ | âœ… (O_DIRECT) | âœ… |
| é›¶æ‹·è´ | âŒ | âŒ | âœ… |
| æ‰¹é‡æäº¤ | âŒ | âŒ | âœ… |
| ç³»ç»Ÿè°ƒç”¨ | æ¯æ¬¡ I/O | æäº¤+è·å– | å¯æ— ï¼ˆå…±äº«å†…å­˜ï¼‰ |

### epoll æµç¨‹

```
ç”¨æˆ·æ€                    å†…æ ¸æ€
  â”‚                         â”‚
  â”œâ”€â”€ epoll_wait() â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ é˜»å¡ç­‰å¾…
  â”‚â—„â”€â”€â”€ è¿”å›å°±ç»ª fd â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â”œâ”€â”€ read(fd) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ å†æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼
  â”‚â—„â”€â”€â”€ æ•°æ® â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
  â””â”€â”€ å¤„ç†æ•°æ®              â”‚
```

### io_uring æµç¨‹

```
ç”¨æˆ·æ€                    å†…æ ¸æ€
  â”‚                         â”‚
  â”œâ”€â”€ å¡«å…… SQEï¼ˆç”¨æˆ·æ€ï¼‰    â”‚ æ— ç³»ç»Ÿè°ƒç”¨
  â”œâ”€â”€ submit() â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ æäº¤è¯·æ±‚
  â”‚   ï¼ˆå¯æ‰¹é‡ï¼‰            â”‚ å†…æ ¸å¼‚æ­¥æ‰§è¡Œ IO
  â”‚                         â”‚
  â”œâ”€â”€ wait_eventfd() â”€â”€â”€â”€â”€â”€â–ºâ”‚ é˜»å¡ç­‰å¾…
  â”‚â—„â”€â”€â”€ eventfd é€šçŸ¥ â”€â”€â”€â”€â”€â”€â”€â”‚ IO å®Œæˆæ—¶è‡ªåŠ¨å†™å…¥
  â””â”€â”€ è¯» CQEï¼ˆç”¨æˆ·æ€ï¼‰      â”‚ æ•°æ®å·²åœ¨å…±äº«å†…å­˜ä¸­
```

### æ¶æ„å¯¹æ¯”å›¾

```
epollï¼šæ¯æ¬¡ IO éƒ½è¦è·¨è¶Šç”¨æˆ·æ€/å†…æ ¸æ€è¾¹ç•Œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    epoll_wait    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æ€  â”‚â—„â”€â”€â”€â”€å°±ç»ªåˆ—è¡¨â”€â”€â”€â”€â”€â”‚ å†…æ ¸æ€  â”‚
â”‚         â”‚â”€â”€â”€â”€read(fd)â”€â”€â”€â”€â”€â–ºâ”‚         â”‚
â”‚         â”‚â—„â”€â”€â”€â”€æ•°æ®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

io_uringï¼šå…±äº«å†…å­˜ + eventfd é€šçŸ¥ï¼Œé›¶æ‹·è´
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·æ€  â”‚â—„â•â•â•å…±äº«å†…å­˜â•â•â•â•â•â–ºâ”‚ å†…æ ¸æ€  â”‚
â”‚   SQ    â”‚    ï¼ˆé›¶æ‹·è´ï¼‰     â”‚         â”‚
â”‚   CQ    â”‚                  â”‚         â”‚
â”‚         â”‚â—„â”€â”€eventfdé€šçŸ¥â”€â”€â”€â”€â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸŒ TCP Awaiter é€šä¿¡æµç¨‹

```
æœåŠ¡ç«¯                              å®¢æˆ·ç«¯
   â”‚                                  â”‚
   â”‚ socket() + bind() + listen()     â”‚ socket()
   â”‚                                  â”‚
   â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    connect()    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ tcp_accept   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ tcp_connect  â”‚
â”‚   awaiter    â”‚                 â”‚   awaiter    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                                  â”‚
   â”‚         è¿æ¥å»ºç«‹å®Œæˆ             â”‚
   â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ tcp_read     â”‚â—„â”€â”€â”€â”€æ•°æ®â”€â”€â”€â”€â”€â”€â”€â”€â”‚ tcp_write    â”‚
â”‚   awaiter    â”‚                 â”‚   awaiter    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                                  â”‚
   â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ tcp_write    â”‚â”€â”€â”€â”€â”€æ•°æ®â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ tcp_read     â”‚
â”‚   awaiter    â”‚                 â”‚   awaiter    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â”‚                                  â”‚
   â–¼                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ tcp_close    â”‚                 â”‚ tcp_close    â”‚
â”‚   awaiter    â”‚                 â”‚   awaiter    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ï¸ tinyCoroLab æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
scheduler (å•ä¾‹ï¼Œç®¡ç†æ‰€æœ‰ context)
    â”‚
    â”œâ”€â”€ context_0  â†â†’  å·¥ä½œçº¿ç¨‹ 0
    â”‚       â””â”€â”€ engine_0 (ä»»åŠ¡é˜Ÿåˆ— + io_uring)
    â”‚
    â”œâ”€â”€ context_1  â†â†’  å·¥ä½œçº¿ç¨‹ 1
    â”‚       â””â”€â”€ engine_1
    â”‚
    â””â”€â”€ context_2  â†â†’  å·¥ä½œçº¿ç¨‹ 2
            â””â”€â”€ engine_2
```

### æ ¸å¿ƒæ¦‚å¿µå¯¹åº”å…³ç³»

| æ¦‚å¿µ | tinyCoroLab ç±» | æ•°é‡å…³ç³» | è¯´æ˜ |
|------|----------------|----------|------|
| è°ƒåº¦å™¨ | `scheduler` | 1 ä¸ªï¼ˆå•ä¾‹ï¼‰ | ç®¡ç†æ‰€æœ‰ context |
| çº¿ç¨‹ | `context` | N ä¸ªï¼ˆ= CPU æ ¸å¿ƒæ•°ï¼‰ | ä¸€ä¸ª context = ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ |
| ä»»åŠ¡è°ƒåº¦å™¨ | `engine` | N ä¸ªï¼ˆæ¯ context 1 ä¸ªï¼‰ | ç®¡ç†ä»»åŠ¡é˜Ÿåˆ— + io_uring |
| åç¨‹ | `task<T>` | å¤šä¸ª | ä¸€ä¸ªåç¨‹å‡½æ•°è¿”å›ä¸€ä¸ª task |
| åŒæ­¥åŸè¯­ | `event` / `mutex` / `latch` | å¤šä¸ª | åç¨‹é—´é€šä¿¡æœºåˆ¶ |

### Engine å†…éƒ¨ç»“æ„

```
context (1ä¸ªçº¿ç¨‹)
    â”‚
    â””â”€â”€ engine ä»»åŠ¡è°ƒåº¦å™¨
            â”‚
            â”œâ”€â”€ ä»»åŠ¡é˜Ÿåˆ— â†â”€â”€ task_1 (åç¨‹1)
            â”‚            â†â”€â”€ task_2 (åç¨‹2)
            â”‚            â†â”€â”€ task_3 (åç¨‹3)
            â”‚
            â””â”€â”€ io_uring (å¼‚æ­¥IO)
```

### åŒæ­¥åŸè¯­ç±»æ¯”

| ä¼ ç»Ÿçº¿ç¨‹ | tinyCoroLab åç¨‹ |
|----------|------------------|
| `std::thread` | `context` |
| `std::condition_variable` | `event` |
| `std::mutex` | `mutex` |
| `std::latch` | `latch` |

> **`event` ä¸æ˜¯æ‰§è¡Œå•å…ƒï¼Œè€Œæ˜¯è®©å¤šä¸ªåç¨‹èƒ½å¤Ÿåè°ƒé…åˆçš„"ä¿¡å·ç¯"**

---

## ğŸ“Š æ€§èƒ½æµ‹è¯•åˆ†æ

### Lab4a Benchmark ç»“æœ

| æµ‹è¯•é¡¹ | 100 ä»»åŠ¡ | 100K ä»»åŠ¡ | 1äº¿ ä»»åŠ¡ |
|--------|----------|-----------|----------|
| threadpool_stl_future | 0.61 ms | 0.66 ms | 61.6 ms |
| coro_stl_future | 4.56 ms | 4.62 ms | 116 ms |
| coro_event | 4.58 ms | 4.73 ms | 130 ms |

### å…³é”®è§‚å¯Ÿ

#### 1. åç¨‹ vs çº¿ç¨‹æ± çš„é€‚ç”¨åœºæ™¯

| åœºæ™¯ | çº¿ç¨‹æ±  | åç¨‹ |
|------|--------|------|
| **CPU å¯†é›†å‹** | âœ… æ›´å¿«ï¼ˆç›´æ¥æ‰§è¡Œï¼‰ | âŒ æœ‰è°ƒåº¦å¼€é”€ |
| **IO å¯†é›†å‹** | âŒ çº¿ç¨‹é˜»å¡æµªè´¹èµ„æº | âœ… æŒ‚èµ·ä¸é˜»å¡ |
| **é«˜å¹¶å‘è¿æ¥** | âŒ çº¿ç¨‹æ•°æœ‰é™ | âœ… è½»æ¾æ•°åä¸‡åç¨‹ |
| **å†…å­˜å ç”¨** | âŒ MB çº§/çº¿ç¨‹ | âœ… KB çº§/åç¨‹ |

#### 2. åç¨‹çš„å›ºå®šå¯åŠ¨å¼€é”€

```
å°ä»»åŠ¡ï¼ˆ100ä¸ªï¼‰æ—¶ï¼š
åç¨‹å¯åŠ¨ + è°ƒåº¦å™¨åˆå§‹åŒ– â‰ˆ 4.5 msï¼ˆå›ºå®šå¼€é”€ï¼‰
```

#### 3. åç¨‹çš„çœŸæ­£ä¼˜åŠ¿åœºæ™¯

- é«˜å¹¶å‘ç½‘ç»œæœåŠ¡å™¨ï¼ˆå¦‚ Web Serverï¼‰
- å¤§é‡ IO ç­‰å¾…çš„ä»»åŠ¡
- éœ€è¦åŒæ—¶ç®¡ç†æ•°ä¸‡è¿æ¥çš„åœºæ™¯

---

## ğŸ“ å¾…è¡¥å……

<!-- åç»­å­¦ä¹ å†…å®¹å¯åœ¨æ­¤æ·»åŠ  -->
